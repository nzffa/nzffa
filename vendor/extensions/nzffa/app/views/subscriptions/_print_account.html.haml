%table{:style => 'width: 100%'}
  %tr
    %td{:style => 'width: 70%'}
      - if params[:action] == 'print_renewal'
        Please amend anything that has changed and write the total in the total column.
        %br
        -keys = NzffaSettings.forest_size_levys.keys - [@subscription.ha_of_planted_trees]
        -areas = keys.sort.map{ |size| "#{size} ha ($#{(NzffaSettings.forest_size_levys[size] + @order.admin_levy).to_i})" }
        Your national levy and forest area levy for other forest size options: #{areas.join(' and ')}
    %td.price{:style => 'width: 15%'}
      Rate
    %td.price{:style => 'width: 15%'}
      Total
  %tr
    %td
      %b Admin levy and Forest Area levy:
      = @subscription.ha_of_planted_trees
      ha
    %td
    %td.price
      =number_to_currency(@order.admin_and_forest_size_levy)
  - if @subscription.belongs_to_fft
    %tr
      %td
        %b Farm Forestry Timbers Marketplace
      %td
      %td.price= number_to_currency(@order.fft_marketplace_levy)
  - if @subscription.receive_tree_grower_magazine?
    %tr
      %td
        %b
          -case @subscription.tree_grower_delivery_location
          -when 'new_zealand'
            NZ Tree Grower Magazine
          -when 'australia'
            NZ Tree Grower Magazine (delivered within Australia)
          -when 'everywhere_else'
            NZ Tree Grower Magazine (International delivery)

        =pluralize(@subscription.nz_tree_grower_copies, 'copy')
        per issue
      %td
      %td.price
        =number_to_currency(@order.tree_grower_levy)

  %tr
    %td
      %b Geographical Branches:
      =@subscription.branch_names.join(', ')
    %td
    %td.price
      = number_to_currency(@order.branches_levy)
  %tr
    %td
      %b Special Interest Groups:
      =@subscription.action_group_names.join(', ')
    %td
    %td.price
      = number_to_currency(@order.action_groups_levy)
  %tr
    %td
      %b Voluntary Research Contribution:
    %td
    %td.price
      = number_to_currency(@subscription.research_fund_contribution_amount)
  - if params[:action] == 'print_renewal'
    %tr
      %td{colspan: 3}
        = check_box_tag :box
        Tick if you want your Research Contribution treated as a donation - receipt will be sent
  - @order.order_lines.select{|ol| ol.kind == 'extra'}.each do |ol|
    %tr
      %td
        %h4= ol.particular
      %td
      %td.price= number_to_currency(ol.amount)
  %tr
    %td{colspan: 3}
      %b Other Products
  - Product.all.each do |product|
    - matching_order_line = @subscription.order.try(:order_line_for_product, product)
    %tr
      %td=       product.name
      %td.price= number_to_currency product.price
      %td.price
        - if matching_order_line
          = number_to_currency(product.price * matching_order_line.quantity)
  - unless params[:action] == 'print'
    %tr
      %td.subtotal
        %b Subtotal:
      %td
      %td.price= number_to_currency(@order.amount)
  %tr
    %td{colspan: 3}
      - if @reader.is_direct_debit?
        %p Pay for Additional Options separately from the Direct Debit or contact us to change the amount

      - if @reader.is_branch_life_member?
        %p
          As you are a Life Member of your branch, your base subscription is paid by the branch.
          %br
          However, you are welcome to purchase any of the Optional Additional items below:

      - if @reader.is_paid_branch_life_member?
        %p Paid branch life member.

      - if @reader.is_life_member?
        %p
          As you are a Life Member of NZFFA, your base subscription is paid by the association.
          %br
          However, you are welcome to purchase any of the Optional Additional items below:

      - if @reader.is_olsens?
        %p
          The invoice for your subscription will be sent directly to PF Olsen's head office.
          %br
          For your information, the preceding were paid last year on your behalf.
          %br
          The following are further subscription options that you may select - please contact NZFFA National Office to amend the invoice

- if params[:action] == 'print_renewal'
  .section
    %h4 Additional Branches
    %table
      -branches = Group.branches.all(:order => 'name') - @subscription.branches
      -branches.in_groups_of(4) do |group|
        %tr
          -group.compact.each do |b|
            %td=check_box_tag b.id
            %td #{b.name} ($#{b.annual_levy.to_i})
  .section
    %h4 Additional Special Interest Groups
    %table
      - action_groups = Group.action_groups.all(:order => 'name') - @subscription.branches
      - (action_groups << Group.find(NzffaSettings.fft_marketplace_group_id)) unless @subscription.groups.include? Group.fft_group
      - action_groups.reverse.in_groups_of(3) do |group|
        %tr
          -group.compact.each do |b|
            %td=check_box_tag b.id
            %td #{b.name} ($#{b.annual_levy.to_i})

%h3.gst-total{style: "text-align: right"}
  -if @subscription.receive_tree_grower_magazine? and @subscription.tree_grower_delivery_location != 'new_zealand'
    NZ Dollar Total
  -else
    GST Inclusive Total
  - if params[:action] == 'print'
    = ": #{number_to_currency(@order.amount)}"
  - else
    %span.spacer{style: "display: inline-block; width: 15%"}
